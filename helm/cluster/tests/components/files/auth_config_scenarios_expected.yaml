apiVersion: apiserver.config.k8s.io/v1beta1
kind: AuthenticationConfiguration
jwt:
  - issuer:
      url: "https://issuer1.example.com"
      audiences:
        - "client1"
    claimMappings:
      username:
        expression: 'claims["sub"]'
  - issuer:
      url: "https://issuer1.example.com"
      audiences:
        - "client1"
    claimMappings:
      username:
        expression: 'claims["sub"]'
  - issuer:
      url: "https://issuer2.example.com"
      audiences:
        - "client2"
    claimMappings:
      username:
        expression: '"oidc:" + claims["sub"]'
      groups:
        expression: "has(claims['groups']) ? (type(claims['groups']) == string ? ['oidc:' + claims['groups']] : claims['groups'].map(g, 'oidc:' + g)) : []"
  - issuer:
      url: "https://issuer3.example.com"
      audiences:
        - "client3"
    claimMappings:
      username:
        expression: 'claims["email"]'
      groups:
        expression: "has(claims['roles']) ? (type(claims['roles']) == string ? [claims['roles']] : claims['roles']) : []"
